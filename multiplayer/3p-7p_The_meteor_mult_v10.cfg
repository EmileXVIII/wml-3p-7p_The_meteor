[multiplayer]
current_time=0
description="This 3p survival scenario allows you to construct buildings and terraform the land(as in A_New_Land scenario) ,for it use team 3 . The recommended starting gold is 200 for team 3 ,dificulty (normal:25 for others,hard:50 for others,very hard:100 for others. Alternative option: choose to be the invador (1:monsters , 2:undead 3,4:orc and trolls)
This version alow you to teleport your leader by standing on boot images
"
experience_modifier=70
id="3p-7p_The_meteor_v10"
map_data="{~add-ons/my_creations/maps/3p-7p_The_meteor.map}"
name="3p-7p_The_meteor_survival-v10"
victory_when_enemies_defeated=yes
{~add-ons/my_creations/base_Macro/macros/special-notes.cfg}
{~add-ons/my_creations/base_Macro/macros/sound-utils.cfg}
{~add-ons/my_creations/base_Macro/macros/animation-utils.cfg}
{~add-ons/my_creations/base_Macro/macros/abilities.cfg}
{~add-ons/my_creations/ANL_utils}

[time]
	blue=0
	green=-15
	id="dawn"
	image="misc/time-schedules/default/schedule-dawn.png"
	lawful_bonus=0
#textdomain wesnoth-help
	name=_"Dawn"
	red=-25
	sound="ambient/morning.ogg"
[/time]
[time]
	blue=0
	green=0
	id="morning"
	image="misc/time-schedules/default/schedule-morning.png"
	lawful_bonus=25
	name=_"Morning"
	red=0
[/time]
[time]
	blue=0
	green=0
	id="afternoon"
	image="misc/time-schedules/default/schedule-afternoon.png"
	lawful_bonus=25
	name=_"Afternoon"
	red=0
[/time]
[time]
	blue=-35
	green=-20
	id="dusk"
	image="misc/time-schedules/default/schedule-dusk.png"
	lawful_bonus=0
	name=_"Dusk"
	red=10
	sound="ambient/night.ogg"
[/time]
[time]
	blue=-13
	green=-45
	id="first_watch"
	image="misc/time-schedules/default/schedule-firstwatch.png"
	lawful_bonus=-25
	name=_"First Watch"
	red=-75
[/time]
[time]
	blue=-13
	green=-45
	id="second_watch"
	image="misc/time-schedules/default/schedule-secondwatch.png"
	lawful_bonus=-25
	name=_"Second Watch"
	red=-75
[/time]
    [side]
        side=1
        canrecruit=yes
        controller=ai
        team_name=1
        user_team_name= _ "teamname^Team 1"
        team_lock=yes
        income_lock=yes
        village_gold=2
        income=20
	gold=0
        shroud=no
        fog=yes
        recruit=Faerie Fire Unit
        type=Walking Corpse
        faction_from_recruit=no
        faction_lock=yes
    [/side]

    [side]
        side=2
        canrecruit=yes
        controller=ai
        team_name=2
        income=20
	gold=0
        user_team_name= _ "teamname^Team 2"
        team_lock=yes
        income_lock=yes
        village_gold=2
        shroud=no
        fog=yes
        recruit=Walking Corpse
        faction_from_recruit=no
        faction_lock=yes
	    [ai]
            aggression=1.0
            recruitment_pattern=fighter
        [/ai]
    [/side]

    [side]
        side=3
        canrecruit=yes
        controller=ai
        team_name=2
        income=20
	gold=0
        user_team_name= _ "teamname^Team 2"
        team_lock=yes
        income_lock=yes
        village_gold=2
        shroud=no
        fog=yes
        recruit=Goblin Spearman
        faction_from_recruit=no
        faction_lock=yes
	[ai]
            aggression=1.0
            recruitment_pattern=fighter
        [/ai]
    [/side]
    [side]
        side=4
        canrecruit=yes
        controller=ai
        team_name=2
        income=20
	gold=0
        user_team_name= _ "teamname^Team 2"
        team_lock=yes
        income_lock=yes
        village_gold=2
        shroud=no
        fog=yes
        recruit=Goblin Spearman
        faction_from_recruit=no
        faction_lock=yes
	[ai]
            aggression=1.0
            recruitment_pattern=fighter
        [/ai]
    [/side]

    [side]
        side=5
        canrecruit=yes
        controller=human
        team_name=3
	gold=0
        user_team_name= _ "teamname^Team 3"
        team_lock=yes
        income_lock=yes
        village_gold=2
        shroud=no
        fog=yes
        recruit=Peasant,Mage
        faction_from_recruit=no
        faction_lock=yes
    [/side]

    [side]
        side=6
        canrecruit=yes
        controller=human
        team_name=3
        user_team_name= _ "teamname^Team 3"
        team_lock=yes
        income_lock=yes
        village_gold=2
	gold=0
        shroud=no
        fog=yes
        recruit=Peasant,Mage
        faction_from_recruit=no
        faction_lock=yes
	[ai]
            aggression=1.0
            recruitment_pattern=fighter
        [/ai]
    [/side]

    [side]
        side=7
        canrecruit=yes
        controller=human
        team_name=3
        user_team_name= _ "teamname^Team 3"
        team_lock=yes
	gold=0
        income_lock=yes
        village_gold=2
        shroud=no
        fog=yes
        recruit=Peasant,Mage
        faction_from_recruit=no
        faction_lock=yes
	[ai]
            aggression=1.0
            recruitment_pattern=fighter
        [/ai]
    [/side]
    [side]
        side=8
        canrecruit=yes
        hidden=yes
        no_leader=yes
        controller=ai
        team_name=3
        income=20
	    gold=0
        user_team_name= _ "teamname^Team 3"
        team_lock=yes
        income_lock=yes
        village_gold=2
        shroud=no
        fog=yes
        faction_from_recruit=no
        faction_lock=yes
	    [ai]
            aggression=1.0
            recruitment_pattern=fighter
        [/ai]
    [/side]

#define FASTER_ON_FLAT UNIT
[modify_unit]
    [filter]
        id={UNIT}.id
    [/filter]
    [object]
        id=faster_on_flat
        duration=scenario
        take_only_once=yes
        [effect]
            apply_to=movement
            increase={UNIT}.max_moves
        [/effect]
        [effect]
            apply_to=movement_costs
            [movement_costs]
                deep_water={UNIT}.movement_costs.deep_water
                shallow_water={UNIT}.movement_costs.shallow_water
                reef={UNIT}.movement_costs.reef
                swamp_water={UNIT}.movement_costs.swamp_water
                # flat={UNIT}.movement_costs.flat
                sand={UNIT}.movement_costs.sand
                forest={UNIT}.movement_costs.forest
                hills={UNIT}.movement_costs.hills
                mountains={UNIT}.movement_costs.mountains
                village={UNIT}.movement_costs.village
                castle={UNIT}.movement_costs.castle
                frozen={UNIT}.movement_costs.frozen
                unwalkable={UNIT}.movement_costs.unwalkable
                cave={UNIT}.movement_costs.cave
                fungus={UNIT}.movement_costs.fungus
            [/movement_costs]
        [/effect]
    [/object]
[/modify_unit]   
#enddef
#define REMOVE_FASTER_ON_FLAT UNIT
[remove_object]
    #[filter]
        id={UNIT}.id
    #[/filter]
    object_id=faster_on_flat
[/remove_object]   
#enddef
#define SAVE_NEW_REY LOCX LOCY ID_PLAYER
[set_variables]
    name=spawnedPlayers
    mode=append
    [value]
        x={LOCX}
        y={LOCY}
        idPlayer={ID_PLAYER}
    [/value]
[/set_variables]
#enddef
#define CREATE_REY RACE SIDE LOCX LOCY
[set_variable]
    name=side_custom_race
    value={RACE}
[/set_variable]
[if]
    [variable]
        name=side_custom_race
        equals="undead"
    [/variable]
    [then]
        [unit]
            id="reyTM$idPlayer"
            type="Dark Adept"
            generate_name=yes
            side={SIDE}
            canrecruit=yes
            extra_recruit=Walking Skeleton
            x={LOCX}
            y={LOCY}
        [/unit]
        {SAVE_NEW_REY {LOCX} {LOCY} "reyTM$idPlayer"}
        [set_variable]
            name=idPlayer
            value="$($idPlayer+1)"
        [/set_variable]
    [/then]
    [else]
        [if]
            [variable]
                name=side_custom_race
                equals="elf"
            [/variable]
            [then]
                [unit]
                    id="reyTM$idPlayer"
                    type="Elvish Fighter"
                    generate_name=yes
                    side={SIDE}
                    canrecruit=yes
                    extra_recruit=ANLEra Elvish Civilian
                    x={LOCX}
                    y={LOCY}
                [/unit]
                {SAVE_NEW_REY {LOCX} {LOCY} "reyTM$idPlayer"}
                [set_variable]
                    name=idPlayer
                    value="$($idPlayer+1)"
                [/set_variable]
            [/then]
            [else]
                [if]
                    [variable]
                        name=side_custom_race
                        equals="dwarf"
                    [/variable]
                    [then]
                        [unit]
                            id="reyTM$idPlayer"
                            type="Dwarvish Fighter"
                            generate_name=yes
                            side={SIDE}
                            canrecruit=yes
                            extra_recruit=ANLEra Dwarvish Miner
                            x={LOCX}
                            y={LOCY}
                        [/unit]
                        {SAVE_NEW_REY {LOCX} {LOCY} "reyTM$idPlayer"}
                        [set_variable]
                            name=idPlayer
                            value="$($idPlayer+1)"
                        [/set_variable]
                    [/then]
                    [else]
                        [if]
                            [variable]
                                name=side_custom_race
                                equals="drake"
                            [/variable]
                            [then]
                                [unit]
                                    id="reyTM$idPlayer"
                                    type="Drake Burner"
                                    generate_name=yes
                                    side={SIDE}
                                    canrecruit=yes
                                    extra_recruit=ANLEra Drake Worker
                                    x={LOCX}
                                    y={LOCY}
                                [/unit]
                                {SAVE_NEW_REY {LOCX} {LOCY} "reyTM$idPlayer"}
                                [set_variable]
                                    name=idPlayer
                                    value="$($idPlayer+1)"
                                [/set_variable]
                            [/then]
                            [else]
                                [if]
                                    [variable]
                                        name=side_custom_race
                                        equals="merman"
                                    [/variable]
                                    [then]
                                        [unit]
                                            id="reyTM$idPlayer"
                                            type="Mermaid Initiate"
                                            generate_name=yes
                                            side={SIDE}
                                            canrecruit=yes
                                            extra_recruit=ANLEra Merman Citizen
                                            x={LOCX}
                                            y={LOCY}
                                        [/unit]
                                        {SAVE_NEW_REY {LOCX} {LOCY} "reyTM$idPlayer"}
                                        [set_variable]
                                            name=idPlayer
                                            value="$($idPlayer+1)"
                                        [/set_variable]
                                    [/then]
                                    [else]
                                        [if]
                                            [variable]
                                                name=side_custom_race
                                                equals="goblin"
                                            [/variable]
                                            [then]
                                                [unit]
                                                    id="reyTM$idPlayer"
                                                    type="Orcish Leader"
                                                    generate_name=yes
                                                    side={SIDE}
                                                    canrecruit=yes
                                                    extra_recruit=Goblin Spearman
                                                    x={LOCX}
                                                    y={LOCY}
                                                [/unit]
                                                {SAVE_NEW_REY {LOCX} {LOCY} "reyTM$idPlayer"}
                                                [set_variable]
                                                    name=idPlayer
                                                    value="$($idPlayer+1)"
                                                [/set_variable]
                                            [/then]
                                        [/if]
                                    [/else]
                                [/if]
                            [/else]
                        [/if]
                    [/else]
                [/if]
            [/else]
        [/if]
    [/else]
[/if]
[set_variable]
    name=side_custom_var
    value=0
[/set_variable]
#enddef

#define MODIFY_TERRAIN_CUSTOM INT NUM_CELL LOCX LOCY
[set_variable]
    name=modify_terrain_custom_var
    value={INT}
[/set_variable]     
[if]
    [variable]
        name=modify_terrain_custom_var
        equals=1
    [/variable]
    [then]
        {MODIFY_TERRAIN ($swarmp[{NUM_CELL}].value) {LOCX} {LOCY}} 
        [set_variable]
            name=side_custom_var
            value=2
        [/set_variable]  
        [set_variable]
            name=side_custom_race
            value="undead"
        [/set_variable]
    [/then]
    [else]
        [if]
            [variable]
                name=modify_terrain_custom_var
                equals=2
            [/variable]
            [then]
                {MODIFY_TERRAIN ($forest[{NUM_CELL}].value) {LOCX} {LOCY}}
                [set_variable]
                    name=side_custom_var
                    value=8
                [/set_variable]  
                [set_variable]
                    name=side_custom_race
                    value="elf"
                [/set_variable]
            [/then]
            [else]
                [if]
                    [variable]
                        name=modify_terrain_custom_var
                        equals=3
                    [/variable]
                    [then]
                        {MODIFY_TERRAIN ($desert[{NUM_CELL}].value) {LOCX} {LOCY}}
                        [set_variable]
                            name=side_custom_var
                            value=8
                        [/set_variable]  
                        [set_variable]
                            name=side_custom_race
                            value="drake"
                        [/set_variable]
                    [/then]
                    [else]
                        [if]
                            [variable]
                                name=modify_terrain_custom_var
                                equals=4
                            [/variable]
                            [then]
                                {MODIFY_TERRAIN ($caves[{NUM_CELL}].value) {LOCX} {LOCY}}
                                [set_variable]
                                    name=side_custom_var
                                    value=8
                                [/set_variable]  
                                [set_variable]
                                    name=side_custom_race
                                    value="dwarf"
                                [/set_variable]
                            [/then]
                            [else]
                                [if]
                                    [variable]
                                        name=modify_terrain_custom_var
                                        equals=5
                                    [/variable]
                                    [then] 
                                        {MODIFY_TERRAIN ($aquatic[{NUM_CELL}].value) {LOCX} {LOCY}}
                                        [set_variable]
                                            name=side_custom_var
                                            value=8
                                        [/set_variable]  
                                        [set_variable]
                                            name=side_custom_race
                                            value="merman"
                                        [/set_variable]
                                    [/then]
                                    [else]
                                        [if]
                                            [variable]
                                                name=modify_terrain_custom_var
                                                equals=6
                                            [/variable]
                                            [then]
                                                {MODIFY_TERRAIN ($plain[{NUM_CELL}].value) {LOCX} {LOCY}}
                                                [set_variable]
                                                    name=side_custom_var
                                                    rand=3..4
                                                [/set_variable]
                                                [set_variable]
                                                    name=side_custom_race
                                                    value="goblin"
                                                [/set_variable]
                                            [/then]
                                        [/if]
                                    [/else]
                                [/if]
                            [/else]
                        [/if]
                    [/else]
                [/if]
            [/else]
        [/if]
    [/else]
[/if]
#enddef
    [event]
        name="start"
        [objectives]
            side=5,6,7
            summary="<small>" + _ "Right-click on your leader during your turn for help" + "</small>" # wmllint: no spellcheck
            [objective]
                description= _ "You must survive until turn 30. (monve next to side 8 unit to gather allies)"
                condition=win
            [/objective]
        [/objectives]
        [objectives]
            side=1,2,3,4
            [objective]
                description= _ "Kill all ennemy leaders"
                condition=win
            [/objective]
        [/objectives]
        [message]
            speaker=narrator
            message= _ "How often should allies try spawn ?"
            side_for=$side_number
            image=wesnoth-icon.png
            [option]
                label= _ "once per payer per turn"
                [command]
                    [set_variable]
                        name=spawnAllies
                        value=0
                    [/set_variable]
                [/command]
            [/option]
            [option]
                label= _ "Once per turn"
                [command]
                    [set_variable]
                        name=spawnAllies
                        value=1
                    [/set_variable]
                [/command]
            [/option]
            [option]
                    label= _ "Once every 2 turns"
                    [command]
                        [set_variable]
                            name=spawnAllies
                            value=2
                        [/set_variable]
                    [/command]
            [/option]
            [option]
                label= _ "Never"
                [command]
                    [set_variable]
                        name=spawnAllies
                        value=-1
                    [/set_variable]
                [/command]
            [/option]
        [/message]
        [command]
            [modify_side]
			    side=8
			    income=5
			[/modify_side]
            [set_variable]
                name=idPlayer
                value=1
            [/set_variable]
            [set_variable]
                name=redDifficulty
                value=0
            [/set_variable]
            [set_variables]
                name=sideDifficulty
                [value]
                    value=0
                [/value]
                [value]
                    value=0
                [/value]
                [value]
                    value=0
                [/value]
                [value]
                    value=0
                [/value]
            [/set_variables]
            [set_variable]
                name=shouldSpawnAllies
                value=0
            [/set_variable]
            [set_variables]
                name=swarmp
                [value]
                    value="Khs"
                [/value]
                [value]
                    value="Chs"
                [/value]
                [value]
                    value="Chs"
                [/value]
                [value]
                    value="Sm"
                [/value]
                [value]
                    value="Ss"
                [/value]
                [value]
                    value="Ss"
                [/value]
                [value]
                    value="Ss"
                [/value]
            [/set_variables]
            [set_variables]
                name=caves
                [value]
                    value="Kud"
                [/value]
                [value]
                    value="Cud"
                [/value]
                [value]
                    value="Cud"
                [/value]
                [value]
                    value="Uue"
                [/value]
                [value]
                    value="Uue"
                [/value]
                [value]
                    value="Uue"
                [/value]
                [value]
                    value="Uue"
                [/value]
            [/set_variables]
            [set_variables]
                name=desert
                [value]
                    value="Kd"
                [/value]
                [value]
                    value="Cd"
                [/value]
                [value]
                    value="Cd"
                [/value]
                [value]
                    value="Dd^Do"
                [/value]
                [value]
                    value="Dd"
                [/value]
                [value]
                    value="Dd"
                [/value]
                [value]
                    value="Dd"
                [/value]
            [/set_variables]
            [set_variables]
                name=aquatic
                [value]
                    value="Km"
                [/value]
                [value]
                    value="Cm"
                [/value]
                [value]
                    value="Cm"
                [/value]
                [value]
                    value="Wo"
                [/value]
                [value]
                    value="Wwr"
                [/value]
                [value]
                    value="Wwr"
                [/value]
                [value]
                    value="Wwr"
                [/value]
            [/set_variables]
            [set_variables]
                name=plain
                [value]
                    value="Ke"
                [/value]
                [value]
                    value="Ce"
                [/value]
                [value]
                    value="Ce"
                [/value]
                [value]
                    value="Gd"
                [/value]
                [value]
                    value="Gd"
                [/value]
                [value]
                    value="Gd"
                [/value]
                [value]
                    value="Gd^Vo"
                [/value]
            [/set_variables]
            [set_variables]
                name=forest
                [value]
                    value="Kv"
                [/value]
                [value]
                    value="Cv"
                [/value]
                [value]
                    value="Cv"
                [/value]
                [value]
                    value="Gs^Fds"
                [/value]
                [value]
                    value="Gs^Fds"
                [/value]
                [value]
                    value="Gs^Fds"
                [/value]
                [value]
                    value="Gs^Fet"
                [/value]
            [/set_variables]
            [set_variable]
                name=idSpawnedPlayers
                value=1
            [/set_variable]
        [/command]
    [/event]

    {~add-ons/my_creations/base_images}
    {~add-ons/my_creations/base_Macro/macros}
    [event]
        name=new turn
        first_time_only=no
        [set_variable]
            name=shouldSpawnAllies
            value="$(1+$shouldSpawnAllies)"
        [/set_variable]
    [/event]
    [event]
        name=turn refresh
        first_time_only=no
        [if]
            [variable]
                name=shouldSpawnAllies
                greater_than_equal_to=0
            [/variable]
            [then]
                [if]
                    [variable]
                        name=spawnAllies
                        greater_than_equal_to=0
                    [/variable]
                    [then]
                        [set_variable]
                            name=shouldSpawnAllies
                            value="$(0-$spawnAllies)"
                        [/set_variable]
                        [set_variable]
                            name=pos.x
                            rand=1..60
                        [/set_variable]
                        [set_variable]
                            name=pos.y
                            rand=1..60
                        [/set_variable]
                        [if]
                            [not]
                                [have_location]
                                    [and]
                                        x=$pos.x
                                        y=$pos.y
                                        radius=1
                                    [/and]
                                    terrain=!,Gg
                                [/have_location]
                            [/not]
                            [then]
                                [store_locations]
                                    [filter_adjacent_location]
                                        x=$pos.x
                                        y=$pos.y
                                    [/filter_adjacent_location]
                                    variable=locs
                                [/store_locations]
                                [set_variable]
                                    name=tmp2
                                    rand=1..6
                                [/set_variable]
                                {MODIFY_TERRAIN_CUSTOM $tmp2 0 $pos.x $pos.y}
                                [for]
                                    variable=i
                                    start=0
                                    end=5
                                    [do]
                                        [set_variable]
                                            name=tmp
                                            value="$($i+1)"
                                        [/set_variable]
                                        {MODIFY_TERRAIN_CUSTOM $tmp2 $tmp ($locs[$i].x) ($locs[$i].y)}
                                    [/do]
                                [/for]
                                {CREATE_REY $side_custom_race $side_custom_var $pos.x $pos.y}
                            [/then]
                            [else]
                            [/else]
                        [/if]
                    [/then]
                [/if]
            [/then]
        [/if]
        [if]
            [variable]
                    name=turn_number
                    equals=1
            [/variable]
            [and]
                [variable]
                    name=side_number
                    greater_than_equal_to=5
                    less_than_equal_to=7
                [/variable]
            [/and]
            [then]
                [message]
                    speaker=narrator
                    message= _ "Which difficulty do you prefer?"
                    side_for=$side_number
                    image=wesnoth-icon.png
                    [option]
                            label= _ "Impossible"
                            [command]
                            [set_variable]
                                name=difficulty
                                value=10
                            [/set_variable]
                        [/command]
                    [/option]
                    [option]
                        label= _ "Very hard"
                        [command]
                            [set_variable]
                                name=difficulty
                                value=4
                            [/set_variable]
                        [/command]
                    [/option]
                    [option]
                            label= _ "hard"
                            [command]
                            [set_variable]
                                name=difficulty
                                value=3
                            [/set_variable]
                        [/command]
                    [/option]
                    [option]
                        label= _ "Quite hard"
                            [command]
                            [set_variable]
                                name=difficulty
                                value=2
                            [/set_variable]
                        [/command]
                    [/option]
                    [option]
                            label= _ "Normal"
                            [command]
                            [set_variable]
                                name=difficulty
                                value=1
                            [/set_variable]
                        [/command]
                    [/option]
                    [option]
                            label= _ "Rather easy"
                            [command]
                            [set_variable]
                                name=difficulty
                                value=0
                            [/set_variable]
                        [/command]
                    [/option]
                [/message]
                [set_variable]
                    name=sideDifficulty[1].value
                    value="$($sideDifficulty[1].value+$difficulty)"
                [/set_variable]
                [if]
                    [variable]
                        name=side_number
                        equals=5
                    [/variable]
                    [then]
                        [set_variable]
                            name=sideDifficulty[2].value
                            value=$difficulty
                        [/set_variable]
                    [/then]
                    [else]
                        [if]
                            [variable]
                                name=side_number
                                equals=6
                            [/variable]
                            [then]
                                [set_variable]
                                    name=sideDifficulty[3].value
                                    value=$difficulty
                                [/set_variable]
                            [/then]
                            [else]
                                [if]
                                    [variable]
                                        name=side_number
                                        equals=7
                                    [/variable]
                                    [then]
                                        [set_variable]
                                            name=sideDifficulty[4].value
                                            value=$difficulty
                                        [/set_variable]
                                    [/then]
                                [/if]
                            [/else]
                        [/if]
                    [/else]
                [/if]
                [modify_side]
                    side="$($side_number-3)"
                    income="$(($difficulty+1)*5)"
                [/modify_side]
                [if]
                    [variable]
                            name=difficulty
                            equals=0
                    [/variable]
                    [then]
                        [gold]
                            side=$side_number
                            amount=250
                        [/gold]
                    [/then]
                [/if]
                [if]
                    [variable]
                            name=difficulty
                            equals=1
                    [/variable]
                    [then]
                        [gold]
                            side=1,2,3,4
                            amount=25
                        [/gold]
                        [gold]
                            side=$side_number
                            amount=200
                        [/gold]
                    [/then]
                [/if]
                [if]
                    [variable]
                            name=difficulty
                            equals=2
                    [/variable]
                    [then]
                        [gold]
                            side=1,2,3,4
                            amount=50
                        [/gold]
                        [gold]
                            side=$side_number
                            amount=175
                        [/gold]
                        {MODIFY_TERRAIN "Cte" 26 3}
                        {MODIFY_TERRAIN "Cte" 28 3}
                        {MODIFY_TERRAIN "Cte" 25 59}
                        {MODIFY_TERRAIN "Cte" 25 58}
                    [/then]
                [/if]
                [if]
                    [variable]
                            name=difficulty
                            equals=3
                    [/variable]
                    [then]
                        [gold]
                            side=1,2,3,4
                            amount=75
                        [/gold]
                        [gold]
                            side=$side_number
                            amount=150
                        [/gold]
                        {MODIFY_TERRAIN "Cte" 26 3}
                        {MODIFY_TERRAIN "Cte" 28 3}
                        {MODIFY_TERRAIN "Cte" 25 2}
                        {MODIFY_TERRAIN "Cte" 25 3}
                        {MODIFY_TERRAIN "Cte" 25 59}
                        {MODIFY_TERRAIN "Cte" 25 58}
                        {MODIFY_TERRAIN "Cte" 24 59}
                        {MODIFY_TERRAIN "Cte" 24 58}
                    [/then]
                [/if]
                [if]
                    [variable]
                            name=difficulty
                            equals=4
                    [/variable]
                    [then]
                        [gold]
                            side=1,2,3,4
                            amount=75
                        [/gold]
                        [gold]
                            side=$side_number
                            amount=100
                        [/gold]
                        {MODIFY_TERRAIN "Cte" 26 3}
                        {MODIFY_TERRAIN "Cte" 28 3}
                        {MODIFY_TERRAIN "Cte" 25 2}
                        {MODIFY_TERRAIN "Cte" 25 3}
                        {MODIFY_TERRAIN "Cte" 29 2}
                        {MODIFY_TERRAIN "Cte" 29 3}
                        {MODIFY_TERRAIN "Cte" 25 59}
                        {MODIFY_TERRAIN "Cte" 25 58}
                        {MODIFY_TERRAIN "Cte" 24 59}
                        {MODIFY_TERRAIN "Cte" 24 58}
                        {MODIFY_TERRAIN "Cte" 29 60}
                        {MODIFY_TERRAIN "Cte" 30 60}
                    [/then]
                [/if]
            [/then]
        [/if]
   [/event]
    [event]
        name=last breath
        first_time_only=no
        {FOREACH spawnedPlayers index}
            [if]
                [variable]
                    name=spawnedPlayers[$index].idPlayer
                    equals=$unit.id
                [/variable]
                [then]
                    [message]
                        speaker = unit
                        side_for = $unit.side
                        message = _"Argh!! I have never imagined such an end..."
                    [/message]
                    [store_locations]
                        [and]
                            x=$spawnedPlayers[$index].x
                            y=$spawnedPlayers[$index].y
                            radius=1
                        [/and]
                        variable=locs
                    [/store_locations]
                    {FOREACH locs i}
                        {MODIFY_TERRAIN "Gg" ($locs[$i].x) ($locs[$i].y)}
                    {NEXT i}
                [/then]
            [/if]
        {NEXT index} 
    [/event]
#define TRAVEL_TO X Y
    [if]
        [have_unit]
            [filter_location]
                x,y={X},{Y}
                radius=1
            [/filter_location]
        [/have_unit]
        [then]
            [chat]
                speaker= _ "Issue"
                message= _ "Cannot teleport to that keep. There are too many units near the destination."
            [/chat]
        [/then]
        [else]
            [teleport]
                [filter]
                    side=$side_number
                    canrecruit=yes
                [/filter]
                x,y={X},{Y}
                clear_shroud=yes
                animate=no
            [/teleport]
        [/else]
    [/if]
#enddef
        [item]
            x,y=1,29
            image="items/boots.png~GS()~O(50%)"
	[/item]
        [item]
            x,y=1,60
            image="items/boots.png~GS()~O(50%)"
	[/item]
        [item]
            x,y=60,60
            image="items/boots.png~GS()~O(50%)"
	[/item]
    [event]
        name=side turn
        first_time_only=no
        [if]
        [have_unit]
            side=$side_number
            canrecruit=yes
            [filter_location]
                x,y=1,29
            [/filter_location]
        [/have_unit]
            [then]
		{TRAVEL_TO 2 60}
            [/then]
        [/if]
        [if]
        [have_unit]
            side=$side_number
            canrecruit=yes
            [filter_location]
                x,y=1,60
            [/filter_location]
        [/have_unit]
            [then]
		{TRAVEL_TO 59 60}
            [/then]
        [/if]
        [if]
        [have_unit]
            side=$side_number
            canrecruit=yes
            [filter_location]
                x,y=60,60
            [/filter_location]
        [/have_unit]
            [then]
		{TRAVEL_TO 2 29}
            [/then]
        [/if]
    [/event]
    [event]
        name=turn 4
	{MODIFY_TERRAIN "Mdd^Xm" 31 31}
	{MODIFY_TERRAIN "Mdd^Xm" 30 31}
	{MODIFY_TERRAIN "Mdd^Xm" 29 32}
	{MODIFY_TERRAIN "Mdd^Xm" 28 32}
	{MODIFY_TERRAIN "Mdd^Xm" 28 33}
	{MODIFY_TERRAIN "Mdd^Xm" 28 34}
	{MODIFY_TERRAIN "Mdd^Xm" 28 35}
	{MODIFY_TERRAIN "Mdd^Xm" 32 31}
	{MODIFY_TERRAIN "Mdd^Xm" 33 32}
	{MODIFY_TERRAIN "Mdd^Xm" 34 32}
	{MODIFY_TERRAIN "Mdd^Xm" 34 33}
	{MODIFY_TERRAIN "Mdd^Xm" 34 34}
	{MODIFY_TERRAIN "Mdd^Xm" 34 35}
	{MODIFY_TERRAIN "Mdd^Xm" 33 36}
	{MODIFY_TERRAIN "Mdd^Xm" 32 36}
	{MODIFY_TERRAIN "Mdd^Xm" 31 37}
	{MODIFY_TERRAIN "Mdd^Xm" 30 36}
	{MODIFY_TERRAIN "Mdd^Xm" 29 36}
    [/event]
    [event]
        name=turn 7

        [allow_recruit]
            side=3,4
            type=Goblin Rouser
        [/allow_recruit]

        [allow_recruit]
            side=2
            type=Soulless
        [/allow_recruit]

        [allow_recruit]
            side=1
            type=Fire Guardian
        [/allow_recruit]
	{MODIFY_TERRAIN "Cte" 26 1}
	{MODIFY_TERRAIN "Cte" 26 60}

    [/event]
    [event]
        name=turn 9

        [allow_recruit]
            side=3,4
            type=Orcish Grunt
        [/allow_recruit]

        [allow_recruit]
            side=2
            type=Skeleton
        [/allow_recruit]
    [/event]

    [event]
        name=turn 11

        [allow_recruit]
            side=3,4
            type=Orcish Archer
        [/allow_recruit]

        [allow_recruit]
            side=2
            type=Skeleton Archer
        [/allow_recruit]
    [/event]

    [event]
        name=turn 13

        [allow_recruit]
            side=3,4
            type=Troll Whelp
        [/allow_recruit]

        [allow_recruit]
            side=2
            type=Ghoul
        [/allow_recruit]

        [disallow_recruit]
            side=3,4
            type=Goblin Spearman,Goblin Rouser
        [/disallow_recruit]

        [disallow_recruit]
            side=2
            type=Walking Corpse,Soulless
        [/disallow_recruit]
	{MODIFY_TERRAIN "Rd" 31 31}
	{MODIFY_TERRAIN "Rd" 30 31}
	{MODIFY_TERRAIN "Rd" 29 32}
	{MODIFY_TERRAIN "Rd" 28 32}
	{MODIFY_TERRAIN "Rd" 28 33}
	{MODIFY_TERRAIN "Rd" 28 34}
	{MODIFY_TERRAIN "Rd" 28 35}
	{MODIFY_TERRAIN "Rd" 32 31}
	{MODIFY_TERRAIN "Rd" 33 32}
	{MODIFY_TERRAIN "Rd" 34 32}
	{MODIFY_TERRAIN "Rd" 34 33}
	{MODIFY_TERRAIN "Rd" 34 34}
	{MODIFY_TERRAIN "Rd" 34 35}
	{MODIFY_TERRAIN "Rd" 33 36}
	{MODIFY_TERRAIN "Rd" 32 36}
	{MODIFY_TERRAIN "Rd" 31 37}
	{MODIFY_TERRAIN "Rd" 30 36}
	{MODIFY_TERRAIN "Rd" 29 36}
	{MODIFY_TERRAIN "Uu" 26 1}
	{MODIFY_TERRAIN "Hh" 26 60}
    [/event]

    [event]
        name=turn 15

        [allow_recruit]
            side=3,4
            type=Orcish Assassin
        [/allow_recruit]

        [allow_recruit]
            side=2
            type=Dark Adept
        [/allow_recruit]
	{MODIFY_TERRAIN "Mdd^Xm" 31 31}
	{MODIFY_TERRAIN "Mdd^Xm" 30 31}
	{MODIFY_TERRAIN "Mdd^Xm" 29 32}
	{MODIFY_TERRAIN "Mdd^Xm" 28 32}
	{MODIFY_TERRAIN "Mdd^Xm" 28 33}
	{MODIFY_TERRAIN "Mdd^Xm" 28 34}
	{MODIFY_TERRAIN "Mdd^Xm" 28 35}
	{MODIFY_TERRAIN "Mdd^Xm" 32 31}
	{MODIFY_TERRAIN "Mdd^Xm" 33 32}
	{MODIFY_TERRAIN "Mdd^Xm" 34 32}
	{MODIFY_TERRAIN "Mdd^Xm" 34 33}
	{MODIFY_TERRAIN "Mdd^Xm" 34 34}
	{MODIFY_TERRAIN "Mdd^Xm" 34 35}
	{MODIFY_TERRAIN "Mdd^Xm" 33 36}
	{MODIFY_TERRAIN "Mdd^Xm" 32 36}
	{MODIFY_TERRAIN "Mdd^Xm" 31 37}
	{MODIFY_TERRAIN "Mdd^Xm" 30 36}
	{MODIFY_TERRAIN "Mdd^Xm" 29 36}
    [/event]
    [event]
        name=turn 16
        [modify_side]
		    side=2
		    income="$(($sideDifficulty[2].value +1)*10)"
		[/modify_side]
        [modify_side]
		    side=3
		    income="$(($sideDifficulty[3].value +1)*10)"
		[/modify_side]
        [modify_side]
		    side=4
		    income="$(($sideDifficulty[4].value +1)*10)"
		[/modify_side]
    [/event]
    [event]
        name=turn 17

        [gold]
            side=1,2,3,4
            amount=50
        [/gold]

        [allow_recruit]
            side=3,4
            type=Troll,Orcish Crossbowman,Orcish Warrior
        [/allow_recruit]

        [allow_recruit]
            side=2
            type=Necrophage,Bone Shooter,Revenant
        [/allow_recruit]

        [allow_recruit]
            side=1
            type=Flies
        [/allow_recruit]
    [/event]
    [event]
        name=turn 19
        [modify_side]
		    side=1
		    income="$(($sideDifficulty[1].value +1)*10)"
		[/modify_side]
        [modify_side]
		    side=2
		    income="$(($sideDifficulty[2].value +1)*20)"
		[/modify_side]
        [modify_side]
		    side=3
		    income="$(($sideDifficulty[3].value +1)*20)"
		[/modify_side]
        [modify_side]
		    side=4
		    income="$(($sideDifficulty[4].value +1)*20)"
		[/modify_side]
    [/event]

    [event]
        name=turn 20

        [allow_recruit]
            side=1
            type=Spell Eater
        [/allow_recruit]
	{MODIFY_TERRAIN "Rd" 31 31}
	{MODIFY_TERRAIN "Rd" 30 31}
	{MODIFY_TERRAIN "Rd" 29 32}
	{MODIFY_TERRAIN "Rd" 28 32}
	{MODIFY_TERRAIN "Rd" 28 33}
	{MODIFY_TERRAIN "Rd" 28 34}
	{MODIFY_TERRAIN "Rd" 28 35}
	{MODIFY_TERRAIN "Rd" 32 31}
	{MODIFY_TERRAIN "Rd" 33 32}
	{MODIFY_TERRAIN "Rd" 34 32}
	{MODIFY_TERRAIN "Rd" 34 33}
	{MODIFY_TERRAIN "Rd" 34 34}
	{MODIFY_TERRAIN "Rd" 34 35}
	{MODIFY_TERRAIN "Rd" 33 36}
	{MODIFY_TERRAIN "Rd" 32 36}
	{MODIFY_TERRAIN "Rd" 31 37}
	{MODIFY_TERRAIN "Rd" 30 36}
	{MODIFY_TERRAIN "Rd" 29 36}
    [/event]

    [event]
        name=turn 23
	{MODIFY_TERRAIN "Mdd^Xm" 31 31}
	{MODIFY_TERRAIN "Mdd^Xm" 30 31}
	{MODIFY_TERRAIN "Mdd^Xm" 29 32}
	{MODIFY_TERRAIN "Mdd^Xm" 28 32}
	{MODIFY_TERRAIN "Mdd^Xm" 28 33}
	{MODIFY_TERRAIN "Mdd^Xm" 28 34}
	{MODIFY_TERRAIN "Mdd^Xm" 28 35}
	{MODIFY_TERRAIN "Mdd^Xm" 32 31}
	{MODIFY_TERRAIN "Mdd^Xm" 33 32}
	{MODIFY_TERRAIN "Mdd^Xm" 34 32}
	{MODIFY_TERRAIN "Mdd^Xm" 34 33}
	{MODIFY_TERRAIN "Mdd^Xm" 34 34}
	{MODIFY_TERRAIN "Mdd^Xm" 34 35}
	{MODIFY_TERRAIN "Mdd^Xm" 33 36}
	{MODIFY_TERRAIN "Mdd^Xm" 32 36}
	{MODIFY_TERRAIN "Mdd^Xm" 31 37}
	{MODIFY_TERRAIN "Mdd^Xm" 30 36}
	{MODIFY_TERRAIN "Mdd^Xm" 29 36}
    [/event]

    [event]
        name=turn 28

        [message]
            side=5,6,7
            canrecruit=yes
            message= _ "This battle is nearly at an end. Victory is close at hand!"
        [/message]
	{MODIFY_TERRAIN "Rd" 31 31}
	{MODIFY_TERRAIN "Rd" 30 31}
	{MODIFY_TERRAIN "Rd" 29 32}
	{MODIFY_TERRAIN "Rd" 28 32}
	{MODIFY_TERRAIN "Rd" 28 33}
	{MODIFY_TERRAIN "Rd" 28 34}
	{MODIFY_TERRAIN "Rd" 28 35}
	{MODIFY_TERRAIN "Rd" 32 31}
	{MODIFY_TERRAIN "Rd" 33 32}
	{MODIFY_TERRAIN "Rd" 34 32}
	{MODIFY_TERRAIN "Rd" 34 33}
	{MODIFY_TERRAIN "Rd" 34 34}
	{MODIFY_TERRAIN "Rd" 34 35}
	{MODIFY_TERRAIN "Rd" 33 36}
	{MODIFY_TERRAIN "Rd" 32 36}
	{MODIFY_TERRAIN "Rd" 31 37}
	{MODIFY_TERRAIN "Rd" 30 36}
	{MODIFY_TERRAIN "Rd" 29 36}
    [/event]

    # Victory!

    [event]
        name=turn 30

        [message]
            side=5,6,7
            canrecruit=yes
            message= _ "We have survived the onslaught! The tide of the battle has turned, victory cannot elude us now!"
        [/message]
        [objectives]
            side=5,6,7
            summary="<small>" + _ "Right-click on your leader during your turn for help" + "</small>" # wmllint: no spellcheck
            [objective]
                description= _ "Kill all ennemy leaders."
                condition=win
            [/objective]
        [/objectives]
        [gold]
            side=1,2,3,4
            amount=75
        [/gold]
        [allow_recruit]
            side=5,6,7
            type=Red Mage,White Mage
        [/allow_recruit]
    [/event]

    [event]
        name=turn 40
        [gold]
            side=1,2,3,4
            amount=100
        [/gold]
        [modify_side]
            side=1
            income=35
        [/modify_side]
    [/event]

    [event]
        name=turn 45
        [gold]
            side=1,2,3,4
            amount=100
        [/gold]
        [modify_side]
            side=1
            income=40
        [/modify_side]
    [/event]

    [event]
        name=turn 50
        [gold]
            side=1,2,3,4
            amount=100
        [/gold]
        [modify_side]
            side=1
            income=45
        [/modify_side]
    [/event]

    [event]
        name=turn 55
        [gold]
            side=1,2,3,4
            amount=100
        [/gold]
        [modify_side]
            side=1
            income=50
        [/modify_side]
    [/event]

    [event]
        name=turn 60
        [gold]
            side=2,3,4
            amount=100
        [/gold]
        [modify_side]
            side=1
            income=55
        [/modify_side]
    [/event]

    [event]
        name=turn 65
        [gold]
            side=2,3,4
            amount=100
        [/gold]
        [modify_side]
            side=1
            income=60
        [/modify_side]
    [/event]

    [event]
        name=turn 70
        [gold]
            side=2,3,4
            amount=100
        [/gold]
        [modify_side]
            side=1
            income=65
        [/modify_side]
    [/event]

    [event]
        name=turn 75
        [gold]
            side=1,2,3,4
            amount=100
        [/gold]
        [modify_side]
            side=1
            income=70
        [/modify_side]
    [/event]

    [event]
        name=turn 80
        [gold]
            side=1,2,3,4
            amount=200
        [/gold]
	{MODIFY_TERRAIN "Rd" 31 34}
	{MODIFY_TERRAIN "Rd" 31 33}
	{MODIFY_TERRAIN "Rd" 30 33}
	{MODIFY_TERRAIN "Rd" 32 33}
	{MODIFY_TERRAIN "Rd" 30 34}
	{MODIFY_TERRAIN "Rd" 32 34}
	{MODIFY_TERRAIN "Rd" 31 35}
	{MODIFY_TERRAIN "Rd" 29 34}
    [/event]

    [event]
        name=turn 150
        [modify_side]
            side=1,2,3
            income=0
        [/modify_side]
        [message]
	    side=5,6,7
            speaker=narrator
            message= _ "War make undead and orc out of ressources"
            image=wesnoth-icon.png
        [/message]
        [message]
	    side=5,6,7
            speaker=narrator
            message= _ "You have won the game, but you may continue if you wish..."
            image=wesnoth-icon.png
        [/message]
    [/event]

    #get side8 units
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=5,6,7
        [/filter]
        [store_unit]
            [filter]
                [and]
                    [filter_adjacent]
                        x=$x1
                        y=$y1
                    [/filter_adjacent]
                [/and]
                side=8
            [/filter]
            variable=units_cust
        [/store_unit]
        {FOREACH units_cust index}
            [modify_unit]
                [filter]
                    x,y=$units_cust[$index].x,$units_cust[$index].y
                [/filter]
                side=$side_number
            [/modify_unit]
        {NEXT index}
    [/event]

    #side8 units died
    [event]
        name=die
        first_time_only=no
        [filter]
            side=8
        [/filter]
        [gold]
            side=1,2,3,4
            amount=$turn_number
        [/gold]
        [gold]
            side=$second_unit.side
            amount=$sideDifficulty[$second_unit.side].value
        [/gold]
    [/event]
    # ------------------------------------------------------
    # ANL Building Logic
    # ------------------------------------------------------

    [event]
        name=prestart

        # Players
        {SET_SIDE_VARIABLES 5}
        {SET_SIDE_VARIABLES 6}
        {SET_SIDE_VARIABLES 7}

        {ANL_HELP}
        {WORKER_OPTIONS "Peasant"}
        {RESEARCH_OPTIONS "Mage,Red Mage,White Mage,Mage of Light,Silver Mage,Arch Mage,Great Mage"}
        {LEADER_OPTIONS}
    [/event]

    # Auto-studying

    {AUTO_STUDYING "Mage,Red Mage,White Mage,Mage of Light,Silver Mage,Arch Mage,Great Mage"}

    # Research complete messages

    [event]
        name=side turn
        first_time_only=no
        [if]
            [variable]
                name=side_number
                greater_than_equal_to=5
            [/variable]

            [then]
                {FARMING_RESEARCH_COMPLETE}
                {MINING_RESEARCH_COMPLETE}
                {WARFARE_RESEARCH_COMPLETE}
            [/then]
        [/if]
    [/event]

    # Remove working status from any working units when starting a turn

    [event]
        name=side turn
        first_time_only=no

        [store_unit]
            [filter]
                side=$side_number

                [filter_wml]
                    [status]
                        worked_this_turn=yes
                    [/status]
                [/filter_wml]
            [/filter]

            kill=yes
            variable=this_side_workers
        [/store_unit]

        {FOREACH this_side_workers i}
            [clear_variable]
                name=this_side_workers[$i].status.worked_this_turn
            [/clear_variable]

            [unstore_unit]
                variable=this_side_workers[$i]
            [/unstore_unit]
        {NEXT i}

        [clear_variable]
            name=this_side_workers
        [/clear_variable]
    [/event]

    # Auto-working

    {AUTO_FARMING "Peasant"}
    {AUTO_MINING "Peasant"}


    # Make AI units destroy player’s buildings

    # Villages
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1,2,3,4
            [filter_location]
                terrain=Gg^Vh
            [/filter_location]
        [/filter]
        {MODIFY_TERRAIN "Rd" $x1 $y1}
        {PLACE_IMAGE "scenery/village-human-burned2.png" $x1 $y1 }
        [sound]
            name=torch.ogg
        [/sound]
    [/event]

    # Farms
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1,2,3,4
            [filter_location]
                terrain=Re^Gvs
            [/filter_location]
        [/filter]
        {MODIFY_TERRAIN "Rd" $x1 $y1}
        {PLACE_IMAGE "scenery/castle-ruins.png" $x1 $y1}
        [sound]
            name=pincers.ogg
        [/sound]
    [/event]

    # Universities & Castles
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1,2,3,4
            [filter_location]
                terrain=Gg^Ve,Gg^Vea,Ch,Cv,Chr,Chw,Kv,Kh,Khr
            [/filter_location]
        [/filter]
        {MODIFY_TERRAIN "Rd" $x1 $y1}
        {PLACE_IMAGE "scenery/rubble.png" $x1 $y1}
        [sound]
            name=dagger-swish.wav
        [/sound]
        [sound]
            name=club.ogg
        [/sound]
    [/event]
    #water castle
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1,2,3,4
            [filter_location]
                terrain=Km,Cm
            [/filter_location]
        [/filter]
        {MODIFY_TERRAIN "Wo" $x1 $y1}
        {PLACE_IMAGE "scenery/rubble.png" $x1 $y1}
        [sound]
            name=dagger-swish.wav
        [/sound]
        [sound]
            name=club.ogg
        [/sound]
    [/event]
    #cave castle
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1,2,3,4
            [filter_location]
                terrain=Kud,Cud
            [/filter_location]
        [/filter]
        {MODIFY_TERRAIN "Uue" $x1 $y1}
        {PLACE_IMAGE "scenery/rubble.png" $x1 $y1}
        [sound]
            name=dagger-swish.wav
        [/sound]
        [sound]
            name=club.ogg
        [/sound]
    [/event]
    #sand castle
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1,2,3,4
            [filter_location]
                terrain=Kd,Cd
            [/filter_location]
        [/filter]
        {MODIFY_TERRAIN "Dd" $x1 $y1}
        {PLACE_IMAGE "scenery/rubble.png" $x1 $y1}
        [sound]
            name=dagger-swish.wav
        [/sound]
        [sound]
            name=club.ogg
        [/sound]
    [/event]

    # Hill mines
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1,2,3,4
            [filter_location]
                terrain=Hh^Vhh
            [/filter_location]
        [/filter]
        {MODIFY_TERRAIN "Hh" $x1 $y1}
        [sound]
            name=dagger-swish.wav
        [/sound]
        [sound]
            name=club.ogg
        [/sound]
    [/event]

    # Mountain mines
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1,2,3,4
            [filter_location]
                terrain=Mm^Vhh
            [/filter_location]
        [/filter]
        {MODIFY_TERRAIN "Mm" $x1 $y1}
        [sound]
            name=dagger-swish.wav
        [/sound]
        [sound]
            name=club.ogg
        [/sound]
    [/event]
    [event]
        name=prerecruit
        first_time_only=no
        [filter]
            side=2,3,4
        [/filter]
        [if]
            [variable]
                name=sideDifficulty[$unit.side].value
                equals=10
            [/variable]
            [then]
                [modify_unit]
                    [filter]
                        id=$unit.id
                    [/filter]
                    [object]
                        id="faster_on_flat"
                        duration=scenario
                        take_only_once=yes
                        [effect]
                            apply_to=movement
                            increase=$unit.max_moves
                        [/effect]
                        [effect]
                            apply_to=movement_costs
                            [movement_costs]
                                deep_water=$unit.movement_costs.deep_water
                                shallow_water=$unit.movement_costs.shallow_water
                                reef=$unit.movement_costs.reef
                                swamp_water=$unit.movement_costs.swamp_water
                                # flat=$unit.movement_costs.flat
                                sand=$unit.movement_costs.sand
                                forest=$unit.movement_costs.forest
                                hills=$unit.movement_costs.hills
                                mountains=$unit.movement_costs.mountains
                                village=$unit.movement_costs.village
                                castle=$unit.movement_costs.castle
                                frozen=$unit.movement_costs.frozen
                                unwalkable=$unit.movement_costs.unwalkable
                                cave=$unit.movement_costs.cave
                                fungus=$unit.movement_costs.fungus
                            [/movement_costs]
                        [/effect]
                    [/object]
                [/modify_unit]      
            [/then]
        [/if]
    [/event]
    [event]
        name=prerecruit
        first_time_only=no
        {FASTER_ON_FLAT $unit}
    [/event]
    [event]
        name=pre advance
        first_time_only=no
        {REMOVE_FASTER_ON_FLAT $unit}
    [/event]
    [event]
        name=post advance
        first_time_only=no
        {FASTER_ON_FLAT $unit}
    [/event]
[/multiplayer]